<!DOCTYPE html>
<html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.3.3/d3.min.js"></script>
	<script src="./pcars_driver.js" charset="utf-8"></script>
	<script src="./lib/jquery-injectCSS/jquery.injectCSS.js" charset="utf-8"></script>
	
	<style type="text/css">
		.svg {
			width: 50px;
			height: 20px;
			padding-right: 100px;
			font: 10px sans-serif;
			color: red;
		}
		
	.stations circle {
			fill: blue;
			stroke: black;
			stroke-width: 1.5px;
		}
		
	</style>
</head>
<!--
	http://christopheviau.com/d3_tutorial/
-->
<body>
	<div class="stations">
		<svg class="marker markertext" style="left: 150px; top:250px;">
			<circle r="4.5" cx="5" cy="5" class="CSS_RacePos_25 CSS_Vehicle_GT3"></circle>
			<text x="0" y="15" fill="red">I love SVG!</text>
		</svg>
		<svg class="marker markertext" style="left: 150px; top:250px;">
			<circle r="4.5" cx="5" cy="5" class="CSS_RacePos_25 CSS_Vehicle_GT3"></circle>
			<text x="0" y="15" fill="red">I love SVG!</text>
		</svg>
	</div>
    <div id="viz1"></div>
    <div id="viz2"></div>
    <div>
    	Stylesheet's contents:
    	<textarea id="output"></textarea>
	</div>
	

    <input type="checkbox" id="checkbox1" />

    <script type="text/javascript">
	

//Test Object;

	var DriverDummy		= new PCARSdriver();
		DriverDummy.SetExampleData();


//draw circle
    var sampleSVG = d3.select("#viz1")
        .append("svg");
 //       .attr("width", 200)
 ///       .attr("height", 200);    

    sampleSVG.append("circle")
        .style("stroke", "gray")
        .style("fill", "white")
        .attr("r", 40)
        .attr("cx", 50)
        .attr("cy", 50)
        .on("mouseover", function(){
		d3.select(this)
	//		.style("fill", "blue")
			.transition()
                        .duration(750)
                        .attr("r", function(d) { 	var tmp = d3.select(this);
							console.log("--- this1: ", tmp.attr("r")   ); 
							console.log("--- this2: ", tmp[0][0].attributes.r   );

							if (tmp.attr("r") <= 100) {
								return  tmp.attr("r") + 1;
							}else{
								return  10;
							}
						});
		})
       .on("mouseout", function(){d3.select(this).style("fill", "white");})
	.on("click", function(){d3.select(this).style("fill", "red");});

var sampleSVG2 = d3.select("#viz2")
        .append("svg");
//        .attr("width", 150)
//        .attr("height", 150);

    sampleSVG2.append("circle")
        .style("stroke", "gray")
        .style("fill", "grey")
        .attr("r", 20)
        .attr("cx", 30)
        .attr("cy", 30)

var sampleSVG3 = d3.select("#viz2")
        .append("svg");
//        .attr("width", 150)
//        .attr("height", 150);

    sampleSVG3.append("circle")
        .attr("r", 20)
        .attr("cx", 30)
        .attr("cy", 30)
        .attr("class", "TestCSSClass");
        
        

// D3 handling to select all svgs

	var svgs =      d3.select("body").selectAll("svg").each( function(obj) { 

				var tmp_obj = d3.select(this);

				console.log("---------- svg object:" , tmp_obj);

				tmp_obj.selectAll("circle")
				.transition()
	    			.duration(750)
				.attr("r", function(d) { return 26; });


				if (0)
				{
					tmp_obj.remove();
				}
				

                        });
	console.log(" --- svgs: " , svgs);

/*
	 var marker = _div.selectAll("svg")
     .data(_data, function (d) { return d.Key; })
     .each(transform) // update existing markers
      .enter().append("svg:svg")
     .each(transform)
     //.attr("class", "marker");
 		.attr("class", function (d){ return d.CSSTextClases });
*/
	
function setStyle(cssText) {
	var sheet = document.createElement('style');
	sheet.type = 'text/css';
	/* Optional */ window.customSheet = sheet;
	(document.head || document.getElementsByTagName('head')[0]).appendChild(sheet);
    return (setStyle = function(cssText, node) {
		if(!node || node.parentNode !== sheet)
            return sheet.appendChild(document.createTextNode(cssText));
		node.nodeValue = cssText;
		return node;
	})(cssText);
};
var vTestCSSClass;

// Event handling Checkboxes

$('#checkbox1').click(function () {

	console.log("Checkbox click:" , this);
	
	if ($('#checkbox1').is(':checked') == false) {
		
		//remove a class
		//ELEMENT.classList.remove("TestCSSClass");
		//overwirte settings within object -> not we want to do
		//$('circle.TestCSSClass').css('fill' , 'white');
		
		//$('circle.TestCSSClass').removeClass('circle.TestCSSClass').addClass('someClassReplacement');
		
		/*
		document.styleSheets[0].cssRules[0].cssText = "\
		     #TestCSSClass {

		     }";
		
		*/
		
		// http://stackoverflow.com/questions/7125453/modifying-css-class-property-values-on-the-fly-with-javascript-jquery
		// http://jsfiddle.net/hdU8s/10/
/*
		var rule1, rule2,
        output = document.getElementById('output');
		console.log("rule1 / rule2 / output" , rule1 + " / " +  rule2 + " / " + output);
		*/
		console.log("+++++++ TestCSSClass " , vTestCSSClass);
		setStyle( '', vTestCSSClass );

		
	}

	if ($('#checkbox1').is(':checked') == true) {

             //alert(" is checked");
             
         ////// 1st solution
	     //$('#TestCSSClass').css('fill', 'green') ;
        
         ////// 2nd solution -> working fine
/*
             $.injectCSS({
            	    "circle.TestCSSClass": {
            	        "fill": "yellow"
            	    }
            	});
*/         

             vTestCSSClass = setStyle(
                     '.TestCSSClass{ fill: grey; } \n',
                     vTestCSSClass
                 );
         
         
         
         //////3rd solution
/*             
             $("<style>")
             .prop("type", "text/css")
             .html("\
           	circle.TestCSSClass{\
                 fill: green;\
                 border: 2px;\
             }")
             .appendTo("head");
*/         
     }

	
	
	
	
	
/*	
	if ($(this).attr('checked')) {
	        alert('is checked');
	} else {
	        alert('is not checked');
	}
*/
})



///////////////////////////////SVG Text changes////////////////////////////////////////////////////
/// http://www.jeromecukier.net/blog/2013/03/05/d3-tutorial-at-strata-redux/  ///
var _div;
var marker;
var _data;


var _data = ['10','60'];
marker = d3.select(".stations")
			.selectAll("svg")
			.selectAll("text")
			.data(_data)
			.each(function(d, i) 
				{ 
					console.log("++++ each() d/i: " , d , " / " + i)
					return d; 
				
				})
			.text(function(d,i)
				{
					console.log("++++ text() d/i: " , d , " / " + i)
					return "Test" + i + d ;
				}
			);
console.log("----- _marker: ", marker);

/*
marker.data(_data)
	  .style("font-size", function(d,i){ 
			console.log("+++++ d/i:  " , d , " / "+ i);
			return d+"px";
	})	


marker.append("text")
	.text(function (d) {
			return "Label2";

	})
*/


    </script>
</body>
</html>
